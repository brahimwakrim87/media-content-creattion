<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS Campagnes M√©dia - Cahier des Charges Architecture Finale</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .meta-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .meta-item {
            text-align: center;
        }

        .meta-item strong {
            display: block;
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .meta-item span {
            font-size: 1.1em;
            font-weight: bold;
        }

        nav {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 3px solid #667eea;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        nav a {
            color: #667eea;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        nav a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        main {
            padding: 40px;
        }

        section {
            margin-bottom: 60px;
            scroll-margin-top: 80px;
        }

        h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            font-size: 1.8em;
            margin: 30px 0 15px 0;
        }

        h4 {
            color: #555;
            font-size: 1.3em;
            margin: 20px 0 10px 0;
        }

        .highlight-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .success-box {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left-color: #28a745;
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left-color: #ffc107;
        }

        .info-box {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            border-left-color: #17a2b8;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tech-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
            transition: transform 0.3s ease;
        }

        .tech-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .tech-card h4 {
            color: #667eea;
            margin-top: 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .feature-item strong {
            color: #28a745;
        }

        .diagram-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            overflow-x: auto;
        }

        .mermaid {
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background: #f8f9fa;
        }

        code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
        }

        pre code {
            background: none;
            padding: 0;
        }

        .phase-timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }

        .phase-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #667eea;
        }

        .phase {
            position: relative;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .phase::before {
            content: '';
            position: absolute;
            left: -34px;
            top: 25px;
            width: 20px;
            height: 20px;
            background: #667eea;
            border: 4px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .advantages-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .advantage-card {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #28a745;
        }

        .advantage-card h4 {
            color: #28a745;
            margin-top: 0;
        }

        footer {
            background: #2d2d2d;
            color: white;
            padding: 40px;
            text-align: center;
        }

        footer p {
            margin: 10px 0;
        }

        .emoji {
            font-size: 1.2em;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            nav {
                display: none;
            }

            .container {
                box-shadow: none;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }

            nav ul {
                flex-direction: column;
            }

            main {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="emoji">üöÄ</span> CMS Campagnes M√©dia</h1>
            <p>Architecture Finale - Cahier des Charges Technique</p>
            <div class="meta-info">
                <div class="meta-item">
                    <strong>Version</strong>
                    <span>2.0 Finale</span>
                </div>
                <div class="meta-item">
                    <strong>Date</strong>
                    <span>F√©vrier 2026</span>
                </div>
                <div class="meta-item">
                    <strong>Backend</strong>
                    <span>Symfony 7.x</span>
                </div>
                <div class="meta-item">
                    <strong>Automation</strong>
                    <span>N8N + Make.com</span>
                </div>
            </div>
        </header>

        <nav>
            <ul>
                <li><a href="#vision">Vision</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#flux-agent">Flux Agent</a></li>
                <li><a href="#stack">Stack Technique</a></li>
                <li><a href="#database">Base de Donn√©es</a></li>
                <li><a href="#workflows">Workflows</a></li>
                <li><a href="#make-integration">Int√©gration Make</a></li>
                <li><a href="#publication">Publication</a></li>
                <li><a href="#phases">Phases</a></li>
            </ul>
        </nav>

        <main>
            <!-- SECTION 1: VISION -->
            <section id="vision">
                <h2><span class="emoji">üéØ</span> Vision du Projet</h2>

                <div class="highlight-box">
                    <h3>Objectif Principal</h3>
                    <p>D√©velopper un <strong>CMS complet de gestion de campagnes de contenu m√©dia</strong> permettant de cr√©er, orchestrer et publier du contenu multi-format sur plusieurs canaux digitaux avec automatisation intelligente.</p>
                </div>

                <h3>Types d'Objets M√©dia G√©r√©s</h3>
                <div class="tech-stack">
                    <div class="tech-card">
                        <h4><span class="emoji">üì±</span> Posts</h4>
                        <p>Contenu social optimis√© pour Facebook, Instagram, Twitter, LinkedIn, TikTok</p>
                    </div>
                    <div class="tech-card">
                        <h4><span class="emoji">üé¨</span> Videos</h4>
                        <p>Vid√©os pour YouTube, TikTok, Instagram Reels, Facebook Watch</p>
                    </div>
                    <div class="tech-card">
                        <h4><span class="emoji">üìù</span> Articles</h4>
                        <p>Articles pour blogs, WordPress, sites custom</p>
                    </div>
                    <div class="tech-card">
                        <h4><span class="emoji">üñºÔ∏è</span> Images</h4>
                        <p>Images optimis√©es pour tous canaux digitaux</p>
                    </div>
                    <div class="tech-card">
                        <h4><span class="emoji">üì¢</span> Advertisements</h4>
                        <p>Publicit√©s payantes (Facebook Ads, Google Ads, LinkedIn Ads)</p>
                    </div>
                </div>

                <h3>Syst√®me d'Affectation Flexible</h3>
                <div class="info-box highlight-box">
                    <h4>Niveau Campagne</h4>
                    <p>Affecter la campagne compl√®te √† une liste de comptes sociaux pr√©configur√©s. Tous les objets de la campagne h√©ritent de ces cibles.</p>
                    <p><strong>Exemple:</strong> Campagne "Lancement Produit X" ‚Üí Facebook Page Entreprise, Instagram @brand, WordPress Blog</p>
                </div>

                <div class="info-box highlight-box">
                    <h4>Niveau Objet (Override)</h4>
                    <p>Affecter individuellement chaque objet √† des cibles sp√©cifiques, ind√©pendamment des cibles de la campagne.</p>
                    <p><strong>Exemple:</strong> Video A ‚Üí YouTube uniquement, Post B ‚Üí Facebook + Twitter uniquement</p>
                </div>

                <h3>Syst√®me de Sourcing (Topics ‚Üí Tags)</h3>
                <div class="highlight-box">
                    <h4>Alimentation par l'Agent</h4>
                    <ul>
                        <li>L'agent pr√©configure des <strong>Topics</strong> (th√©matiques principales)</li>
                        <li>Chaque topic contient plusieurs <strong>Tags</strong> (mots-cl√©s)</li>
                        <li>Structure hi√©rarchique : Topic ‚Üí Tags ‚Üí Objets</li>
                    </ul>

                    <h4>Sourcing de Contenu</h4>
                    <ul>
                        <li><strong>Manuel:</strong> Upload direct (video, image, text, audio)</li>
                        <li><strong>Automatique:</strong> APIs externes (Unsplash, Pexels), scraping, import en masse</li>
                    </ul>

                    <h4>Utilisation</h4>
                    <p>Le gestionnaire de campagne utilise ces donn√©es pour classifier automatiquement le contenu et obtenir des suggestions intelligentes bas√©es sur les tags.</p>
                </div>
            </section>

            <!-- SECTION 2: ARCHITECTURE HYBRIDE -->
            <section id="architecture">
                <h2><span class="emoji">üèóÔ∏è</span> Architecture Hybride : N8N + Make.com</h2>

                <div class="warning-box highlight-box">
                    <h3>S√©paration des Responsabilit√©s</h3>
                    <p><strong>Important:</strong> S√©paration claire entre g√©n√©ration de contenu et publication</p>
                </div>

                <div class="tech-stack">
                    <div class="tech-card">
                        <h4><span class="emoji">üé®</span> N8N - Content Generation & Analytics</h4>
                        <ul>
                            <li>üé¨ G√©n√©ration de vid√©os (assemblage, montage, sous-titres)</li>
                            <li>üñºÔ∏è Traitement d'images (resize, watermark, optimisation)</li>
                            <li>üìù G√©n√©ration de texte (GPT/Claude)</li>
                            <li>üéµ Traitement audio (transcription, TTS)</li>
                            <li>ü§ñ Classification IA automatique</li>
                            <li>üìä Collection d'analytics (toutes les heures)</li>
                            <li>üì• Sourcing automatique</li>
                        </ul>
                    </div>

                    <div class="tech-card">
                        <h4><span class="emoji">üì§</span> Make.com - Publication UNIQUEMENT</h4>
                        <ul>
                            <li>üì§ Publication multi-plateforme</li>
                            <li>üîó Gestion OAuth des comptes sociaux</li>
                            <li>‚ö° Ex√©cution instantan√©e via webhooks</li>
                            <li>üîÑ Retry automatique en cas d'√©chec</li>
                            <li>‚úÖ Pas de gestion de tokens dans le CMS</li>
                        </ul>
                    </div>
                </div>

                <h3>Avantages de cette Approche</h3>
                <div class="advantages-list">
                    <div class="advantage-card">
                        <h4>Make.com</h4>
                        <ul>
                            <li>‚úÖ Pas de gestion OAuth complexe</li>
                            <li>‚úÖ 1500+ int√©grations pr√™tes</li>
                            <li>‚úÖ Pas de maintenance d'API</li>
                            <li>‚úÖ Workflows visuels faciles √† d√©boguer</li>
                            <li>‚úÖ Retry automatique int√©gr√©</li>
                        </ul>
                    </div>

                    <div class="advantage-card">
                        <h4>N8N</h4>
                        <ul>
                            <li>‚úÖ Open-source & auto-h√©berg√©</li>
                            <li>‚úÖ Contr√¥le total des workflows</li>
                            <li>‚úÖ Pas de limites de quota</li>
                            <li>‚úÖ Int√©gration IA avanc√©e</li>
                            <li>‚úÖ Personnalisation compl√®te</li>
                        </ul>
                    </div>

                    <div class="advantage-card">
                        <h4>SharePoint</h4>
                        <ul>
                            <li>‚úÖ Int√©gration M365 native</li>
                            <li>‚úÖ Permissions granulaires (ACL)</li>
                            <li>‚úÖ Versioning automatique</li>
                            <li>‚úÖ Pr√©visualisation native</li>
                            <li>‚úÖ Pas de co√ªts S3</li>
                        </ul>
                    </div>

                    <div class="advantage-card">
                        <h4>Meilisearch</h4>
                        <ul>
                            <li>‚úÖ Ultra rapide (&lt; 50ms)</li>
                            <li>‚úÖ Facile √† d√©ployer (Docker)</li>
                            <li>‚úÖ Typo-tolerant</li>
                            <li>‚úÖ Faceted search</li>
                            <li>‚úÖ L√©ger (vs Elasticsearch)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: FLUX AGENT -->
            <section id="flux-agent">
                <h2><span class="emoji">‚öôÔ∏è</span> Configuration Initiale par l'Agent</h2>

                <div class="success-box highlight-box">
                    <h3>Principe Cl√©</h3>
                    <p><strong>L'agent configure une fois, tous les utilisateurs utilisent.</strong></p>
                    <p>Les comptes sociaux sont pr√©configur√©s par l'agent avec OAuth, puis r√©utilis√©s dans toutes les campagnes.</p>
                </div>

                <h3>Flux de Cr√©ation de Compte Social</h3>

                <div class="diagram-container">
                    <pre class="mermaid">
sequenceDiagram
    participant Agent
    participant CMS
    participant MakeAPI as Make API
    participant Facebook

    Agent->>CMS: Add Social Account (Facebook Page)
    CMS->>MakeAPI: POST /connections (Create OAuth URL)
    MakeAPI-->>CMS: Return OAuth URL

    CMS->>Agent: Display "Cliquez pour authentifier"
    Agent->>Facebook: Click ‚Üí OAuth Authorization
    Facebook->>Agent: "Authorize App?"
    Agent->>Facebook: YES (Authorize)

    Facebook->>MakeAPI: Authorization Code
    MakeAPI->>MakeAPI: Create Connection (conn_fb_001)

    MakeAPI->>MakeAPI: Auto-Create Basic Scenario:<br/>1. Webhook Trigger<br/>2. Get Media from Payload<br/>3. Facebook Create Post<br/>4. HTTP Callback CMS

    MakeAPI->>CMS: Webhook Callback
    Note over MakeAPI,CMS: {<br/>  connection_id: conn_fb_001,<br/>  scenario_id: scen_123,<br/>  webhook_url: "https://hook.make.com/xyz"<br/>}

    CMS->>CMS: Store in social_accounts table
    CMS->>Agent: Notification "Compte configur√© ‚úì"
                    </pre>
                </div>

                <h3>Donn√©es Stock√©es dans le CMS</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Champ</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>platform</code></td>
                            <td>VARCHAR(50)</td>
                            <td>facebook, instagram, youtube, tiktok, wordpress</td>
                        </tr>
                        <tr>
                            <td><code>account_name</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Ex: "Page Facebook Entreprise"</td>
                        </tr>
                        <tr>
                            <td><code>account_identifier</code></td>
                            <td>VARCHAR(255)</td>
                            <td>page_id, channel_id, account_username</td>
                        </tr>
                        <tr>
                            <td><code>make_connection_id</code></td>
                            <td>BIGINT</td>
                            <td>ID de la connexion Make.com</td>
                        </tr>
                        <tr>
                            <td><code>make_scenario_id</code></td>
                            <td>BIGINT</td>
                            <td>ID du sc√©nario Make.com auto-cr√©√©</td>
                        </tr>
                        <tr>
                            <td><code>webhook_url</code></td>
                            <td>TEXT</td>
                            <td>URL du webhook Make pour publication</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>VARCHAR(50)</td>
                            <td>active, expired, revoked</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Sc√©nario Make Basique Auto-cr√©√©</h3>
                <div class="highlight-box">
                    <h4>Structure Minimale (3 modules)</h4>
                    <pre><code>{
  "modules": [
    {
      "1": "Webhook Trigger",
      "input": {
        "object_id": 789,
        "campaign_id": 123,
        "content": {
          "message": "Texte du post",
          "media_url": "https://sharepoint.com/.../image.jpg",
          "hashtags": ["tech", "innovation"]
        },
        "platform_config": {
          "page_id": "123456789"
        }
      }
    },
    {
      "2": "Facebook Create Post",
      "connection": "{{MAKE_CONNECTION_ID}}",
      "page_id": "{{1.platform_config.page_id}}",
      "message": "{{1.content.message}}",
      "picture": "{{1.content.media_url}}"
    },
    {
      "3": "HTTP Callback",
      "url": "https://cms.example.com/api/webhooks/status",
      "body": {
        "object_id": "{{1.object_id}}",
        "status": "success",
        "external_id": "{{2.id}}",
        "platform": "facebook"
      }
    }
  ]
}</code></pre>
                </div>
            </section>

            <!-- SECTION 4: STACK TECHNIQUE -->
            <section id="stack">
                <h2><span class="emoji">üõ†Ô∏è</span> Stack Technologique Final</h2>

                <div class="tech-stack">
                    <div class="tech-card">
                        <h4>Backend</h4>
                        <p><strong>Symfony 7.x</strong></p>
                        <p>PHP 8.2+</p>
                    </div>

                    <div class="tech-card">
                        <h4>Database</h4>
                        <p><strong>PostgreSQL 15+</strong></p>
                        <p>Full-Text Search int√©gr√©</p>
                    </div>

                    <div class="tech-card">
                        <h4>Cache</h4>
                        <p><strong>Redis 7+</strong></p>
                        <p>Sessions & Cache</p>
                    </div>

                    <div class="tech-card">
                        <h4>Queue</h4>
                        <p><strong>RabbitMQ</strong></p>
                        <p>Message broker</p>
                    </div>

                    <div class="tech-card">
                        <h4>Search</h4>
                        <p><strong>Meilisearch</strong></p>
                        <p>+ PostgreSQL FTS</p>
                    </div>

                    <div class="tech-card">
                        <h4>Storage</h4>
                        <p><strong>SharePoint</strong></p>
                        <p>via Microsoft Graph API</p>
                    </div>

                    <div class="tech-card">
                        <h4>Publication</h4>
                        <p><strong>Make.com</strong></p>
                        <p>Gateway multi-plateforme</p>
                    </div>

                    <div class="tech-card">
                        <h4>Content Generation</h4>
                        <p><strong>N8N</strong></p>
                        <p>Workflows automatis√©s</p>
                    </div>
                </div>

                <h3>Composants Symfony Cl√©s</h3>
                <div class="features-grid">
                    <div class="feature-item">
                        <strong>Symfony Messenger</strong> - Async message handling
                    </div>
                    <div class="feature-item">
                        <strong>API Platform</strong> - RESTful API generation
                    </div>
                    <div class="feature-item">
                        <strong>Doctrine ORM</strong> - Database abstraction
                    </div>
                    <div class="feature-item">
                        <strong>Symfony Security</strong> - Authentication & authorization
                    </div>
                    <div class="feature-item">
                        <strong>Symfony Workflow</strong> - Content approval workflow
                    </div>
                    <div class="feature-item">
                        <strong>LexikJWTAuthenticationBundle</strong> - JWT tokens
                    </div>
                    <div class="feature-item">
                        <strong>VichUploaderBundle</strong> - File uploads
                    </div>
                    <div class="feature-item">
                        <strong>EasyAdmin</strong> - Admin dashboard
                    </div>
                </div>
            </section>

            <!-- SECTION 5: DATABASE -->
            <section id="database">
                <h2><span class="emoji">üóÑÔ∏è</span> Sch√©ma Base de Donn√©es Simplifi√©</h2>

                <div class="diagram-container">
                    <pre class="mermaid">
erDiagram
    User ||--o{ Campaign : creates
    User ||--o{ SocialAccount : owns

    Campaign ||--o{ Article : contains
    Campaign ||--o{ Post : contains
    Campaign ||--o{ Ad : contains
    Campaign ||--o{ CampaignTarget : defines

    Article ||--o{ Publication : generates
    Post ||--o{ Publication : generates
    Ad ||--o{ Publication : generates

    SocialAccount ||--o{ CampaignTarget : targeted_by
    SocialAccount ||--o{ Publication : published_to

    Publication ||--o{ AnalyticsMetric : tracks

    Article }o--o{ Tag : tagged_with
    Post }o--o{ Tag : tagged_with
    Article }o--o{ Topic : categorized_in

    Article }o--o{ MediaAsset : uses
    Post }o--o{ MediaAsset : uses

    User {
        int id PK
        string email UK
        string password
        string first_name
        string last_name
    }

    Campaign {
        int id PK
        string name
        int user_id FK
        string status
        date start_date
        date end_date
    }

    SocialAccount {
        int id PK
        string platform
        string account_name
        string account_identifier
        bigint make_connection_id
        bigint make_scenario_id
        text webhook_url
        string status
        int created_by FK
    }

    CampaignTarget {
        int id PK
        int campaign_id FK
        int social_account_id FK
        boolean is_active
    }

    Article {
        int id PK
        string title
        text content
        int campaign_id FK
        string status
    }

    Post {
        int id PK
        text content
        int campaign_id FK
        string status
    }

    Publication {
        int id PK
        int object_id
        string content_type
        int social_account_id FK
        string external_id
        string status
        timestamp published_at
    }

    AnalyticsMetric {
        int id PK
        int publication_id FK
        string metric_type
        decimal value
        timestamp measured_at
    }

    Tag {
        int id PK
        string name UK
    }

    Topic {
        int id PK
        string name UK
    }

    MediaAsset {
        int id PK
        string filename
        string type
        string cdn_url
    }
                    </pre>
                </div>

                <h3>Tables Principales</h3>

                <h4>1. social_accounts (Comptes Globaux)</h4>
                <pre><code>CREATE TABLE social_accounts (
    id SERIAL PRIMARY KEY,
    platform VARCHAR(50) NOT NULL,              -- facebook, instagram, youtube
    account_name VARCHAR(255) NOT NULL,         -- "Page Facebook Entreprise"
    account_identifier VARCHAR(255),            -- page_id, channel_id
    make_connection_id BIGINT NOT NULL,         -- Connexion Make.com
    make_scenario_id BIGINT NOT NULL,           -- Sc√©nario Make.com
    webhook_url TEXT NOT NULL,                  -- URL du webhook
    status VARCHAR(50) DEFAULT 'active',        -- active, expired, revoked
    created_by INT REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);</code></pre>

                <h4>2. campaign_targets (Associations Campagnes ‚Üî Comptes)</h4>
                <pre><code>CREATE TABLE campaign_targets (
    id SERIAL PRIMARY KEY,
    campaign_id INT REFERENCES campaigns(id) ON DELETE CASCADE,
    social_account_id INT REFERENCES social_accounts(id) ON DELETE CASCADE,
    is_active BOOLEAN DEFAULT true,

    UNIQUE(campaign_id, social_account_id)
);</code></pre>

                <h4>3. publications</h4>
                <pre><code>CREATE TABLE publications (
    id SERIAL PRIMARY KEY,
    object_id INT NOT NULL,                     -- FK vers article/post/ad
    content_type VARCHAR(50) NOT NULL,          -- 'article', 'post', 'ad'
    social_account_id INT REFERENCES social_accounts(id),
    external_id VARCHAR(255),                   -- post_id from Facebook/Instagram
    status VARCHAR(50) NOT NULL,                -- pending, published, failed
    published_at TIMESTAMP,
    error_message TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);</code></pre>
            </section>

            <!-- SECTION 6: WORKFLOWS -->
            <section id="workflows">
                <h2><span class="emoji">üîÑ</span> Workflows Complets</h2>

                <h3>Flux 1: G√©n√©ration de Contenu (N8N)</h3>
                <div class="diagram-container">
                    <pre class="mermaid">
sequenceDiagram
    participant User
    participant CMS
    participant N8N
    participant SharePoint

    User->>CMS: Create Video Object
    CMS->>N8N: Webhook: Generate Video

    N8N->>N8N: Download source clips
    N8N->>N8N: Assemble video (ffmpeg)
    N8N->>N8N: Add subtitles (Whisper AI)
    N8N->>N8N: Generate thumbnail

    N8N->>SharePoint: Upload video.mp4
    SharePoint-->>N8N: File ID & URL
    N8N->>SharePoint: Create sharing link
    SharePoint-->>N8N: Public URL

    N8N->>CMS: Webhook: Content Ready
    CMS->>CMS: Update object: media_url
    CMS-->>User: Notification "Vid√©o pr√™te ‚úì"
                    </pre>
                </div>

                <h3>Flux 2: Publication Multi-Plateforme (Make.com)</h3>
                <div class="diagram-container">
                    <pre class="mermaid">
sequenceDiagram
    participant User
    participant CMS
    participant Make as Make Scenario
    participant FB as Facebook
    participant IG as Instagram

    User->>CMS: Approve & Publish
    CMS->>CMS: Prepare payload

    par Multi-Platform
        CMS->>Make: POST webhook (Facebook)
        Make->>FB: Create Post
        FB-->>Make: post_id: fb_789

        CMS->>Make: POST webhook (Instagram)
        Make->>IG: Create Media
        IG-->>Make: media_id: ig_456
    end

    par Callbacks
        Make->>CMS: Status (Facebook success)
        Make->>CMS: Status (Instagram success)
    end

    CMS->>CMS: Update publications table
    CMS-->>User: Notification "Publi√© ‚úì"
                    </pre>
                </div>

                <h3>Flux 3: Collection Analytics (N8N)</h3>
                <div class="diagram-container">
                    <pre class="mermaid">
graph LR
    A[N8N Cron<br/>Every Hour] --> B{For Each Publication}
    B --> C[Facebook API<br/>Get Insights]
    B --> D[Instagram API<br/>Get Insights]
    B --> E[YouTube API<br/>Get Analytics]

    C --> F[Store Metrics]
    D --> F
    E --> F

    F --> G[CMS Database]
    G --> H[Update Dashboard]
    H --> I[User Notification<br/>if Thresholds]
                    </pre>
                </div>
            </section>

            <!-- SECTION 7: MAKE INTEGRATION -->
            <section id="make-integration">
                <h2><span class="emoji">üîó</span> Int√©gration Make.com API</h2>

                <h3>Endpoint 1: Cr√©ation de Connexion OAuth</h3>
                <div class="highlight-box">
                    <h4>POST https://eu1.make.com/api/v2/connections</h4>
                    <pre><code>{
  "accountName": "Page Facebook Entreprise",
  "accountType": "facebook-pages",
  "scopes": ["pages_manage_posts", "pages_read_engagement"],
  "metadata": {
    "created_by_agent": true
  }
}</code></pre>

                    <h4>Response</h4>
                    <pre><code>{
  "connection": {
    "id": 789012,
    "accountName": "Page Facebook Entreprise",
    "verified": false,
    "authUrl": "https://www.facebook.com/v18.0/dialog/oauth?client_id=...",
    "callbackUrl": "https://cms.example.com/make/callback"
  }
}</code></pre>
                </div>

                <h3>Endpoint 2: Cr√©ation de Sc√©nario Basique</h3>
                <div class="highlight-box">
                    <h4>POST https://eu1.make.com/api/v2/scenarios</h4>
                    <pre><code>{
  "name": "Publication Facebook - Page Entreprise",
  "teamId": 123456,
  "blueprint": {
    "flow": [
      {
        "id": 1,
        "module": "gateway:CustomWebHook",
        "parameters": {"hook": "fb-page-entreprise"}
      },
      {
        "id": 2,
        "module": "facebook:CreatePost",
        "version": 3,
        "parameters": {
          "connection": 789012,
          "pageId": "{{1.platform_config.page_id}}"
        },
        "mapper": {
          "message": "{{1.content.message}}",
          "picture": "{{1.content.media_url}}"
        }
      },
      {
        "id": 3,
        "module": "http:ActionSendData",
        "parameters": {
          "url": "https://cms.example.com/api/webhooks/status",
          "method": "POST"
        },
        "mapper": {
          "object_id": "{{1.object_id}}",
          "status": "success",
          "external_id": "{{2.id}}",
          "platform": "facebook"
        }
      }
    ]
  },
  "scheduling": {"type": "immediately"}
}</code></pre>

                    <h4>Response</h4>
                    <pre><code>{
  "scenario": {
    "id": 456789,
    "name": "Publication Facebook - Page Entreprise",
    "webhookUrl": "https://hook.eu1.make.com/fb-page-entreprise",
    "state": "active"
  }
}</code></pre>
                </div>

                <h3>Endpoint 3: Trigger Publication via Webhook</h3>
                <div class="highlight-box">
                    <h4>POST https://hook.eu1.make.com/fb-page-entreprise</h4>
                    <pre><code>{
  "object_id": 789,
  "campaign_id": 123,
  "content": {
    "message": "D√©couvrez notre nouveau produit !",
    "media_url": "https://sharepoint.com/.../product.jpg",
    "hashtags": ["innovation", "tech"]
  },
  "platform_config": {
    "page_id": "123456789"
  }
}</code></pre>
                </div>

                <h3>Sc√©narios Templates par Plateforme</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Plateforme</th>
                            <th>Module Make</th>
                            <th>Champs Requis</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Facebook</strong></td>
                            <td>facebook:CreatePost</td>
                            <td>page_id, message, picture/link</td>
                        </tr>
                        <tr>
                            <td><strong>Instagram</strong></td>
                            <td>instagram:CreateMedia</td>
                            <td>image_url, caption</td>
                        </tr>
                        <tr>
                            <td><strong>YouTube</strong></td>
                            <td>youtube:UploadVideo</td>
                            <td>video_url, title, description</td>
                        </tr>
                        <tr>
                            <td><strong>WordPress</strong></td>
                            <td>wordpress:CreatePost</td>
                            <td>title, content, featured_media</td>
                        </tr>
                        <tr>
                            <td><strong>Twitter/X</strong></td>
                            <td>twitter:CreateTweet</td>
                            <td>text, media_ids</td>
                        </tr>
                        <tr>
                            <td><strong>LinkedIn</strong></td>
                            <td>linkedin:ShareUpdate</td>
                            <td>text, content_url</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- SECTION 8: PUBLICATION -->
            <section id="publication">
                <h2><span class="emoji">üöÄ</span> Flux de Publication D√©taill√©</h2>

                <div class="diagram-container">
                    <pre class="mermaid">
graph TB
    START([User Approves Object])

    START --> PREPARE[CMS Prepare Payload]
    PREPARE --> CHECK{Targets Assigned?}

    CHECK -->|Campaign Level| INHERIT[Use Campaign Targets]
    CHECK -->|Object Level| OVERRIDE[Use Object Targets]

    INHERIT --> TARGETS[List of Social Accounts]
    OVERRIDE --> TARGETS

    TARGETS --> LOOP{For Each Target}

    LOOP --> GET_WEBHOOK[Get webhook_url<br/>from social_accounts]
    GET_WEBHOOK --> POST[POST to Make Webhook]

    POST --> MAKE[Make Scenario Executes]
    MAKE --> PUBLISH[Publish to Platform]

    PUBLISH --> SUCCESS{Success?}

    SUCCESS -->|Yes| CALLBACK_OK[Callback CMS<br/>status: success<br/>external_id]
    SUCCESS -->|No| CALLBACK_FAIL[Callback CMS<br/>status: failed<br/>error_message]

    CALLBACK_OK --> STORE[Store in publications]
    CALLBACK_FAIL --> STORE

    STORE --> MORE{More Targets?}
    MORE -->|Yes| LOOP
    MORE -->|No| NOTIFY[Notify User]

    NOTIFY --> END([Publication Complete])

    style START fill:#667eea,color:#fff
    style END fill:#48bb78,color:#fff
    style MAKE fill:#764ba2,color:#fff
                    </pre>
                </div>

                <h3>Exemple de Payload CMS ‚Üí Make</h3>
                <pre><code>{
  "object_id": 789,
  "campaign_id": 123,
  "content": {
    "message": "üöÄ D√©couvrez notre nouveau produit innovant !",
    "media_url": "https://tenant.sharepoint.com/sites/MediaCMS/Shared%20Documents/media/123/789/product-video.mp4",
    "link": "https://example.com/product",
    "hashtags": ["innovation", "tech", "product2026"]
  },
  "platform_config": {
    "page_id": "123456789",
    "scheduled_time": null
  },
  "callback_url": "https://cms.example.com/api/webhooks/publication-status"
}</code></pre>

                <h3>Exemple de Callback Make ‚Üí CMS</h3>
                <pre><code>{
  "object_id": 789,
  "platform": "facebook",
  "status": "success",
  "external_id": "123456789_987654321",
  "published_at": "2026-02-15T14:30:00Z",
  "metadata": {
    "post_url": "https://facebook.com/123456789/posts/987654321"
  }
}</code></pre>
            </section>

            <!-- SECTION 9: PHASES -->
            <section id="phases">
                <h2><span class="emoji">üìÖ</span> Phases d'Impl√©mentation</h2>

                <div class="phase-timeline">
                    <div class="phase">
                        <h3>Phase 1: Foundation (MVP)</h3>
                        <ul>
                            <li>User authentication & authorization (Symfony Security)</li>
                            <li>Basic CMS (articles, posts, ads)</li>
                            <li>Media library (SharePoint Graph API)</li>
                            <li>Agent configuration de comptes sociaux</li>
                            <li>Int√©gration Make.com API (cr√©ation connexions + sc√©narios)</li>
                            <li>Single social media integration (Facebook)</li>
                            <li>Basic publication scheduling</li>
                            <li>Simple analytics dashboard</li>
                        </ul>
                    </div>

                    <div class="phase">
                        <h3>Phase 2: Multi-Platform</h3>
                        <ul>
                            <li>Instagram, YouTube, LinkedIn, Twitter/X integration</li>
                            <li>Website publishing (WordPress adapter)</li>
                            <li>Advanced scheduling with optimal timing</li>
                            <li>Content workflow (Draft ‚Üí Review ‚Üí Approved ‚Üí Published)</li>
                            <li>Enhanced analytics with trend analysis</li>
                            <li>Bulk publication</li>
                        </ul>
                    </div>

                    <div class="phase">
                        <h3>Phase 3: Automation & AI</h3>
                        <ul>
                            <li>N8N workflows for content generation</li>
                            <li>AI-powered auto-classification (OpenAI/Claude)</li>
                            <li>Content sourcing integrations (Unsplash, Pexels)</li>
                            <li>Campaign management with goals & KPIs</li>
                            <li>A/B testing</li>
                            <li>Recommendation engine</li>
                            <li>Automated analytics collection</li>
                        </ul>
                    </div>

                    <div class="phase">
                        <h3>Phase 4: Enterprise Features</h3>
                        <ul>
                            <li>Team collaboration & workspace management</li>
                            <li>Multi-workspace support</li>
                            <li>Advanced reporting & scheduled reports</li>
                            <li>Custom dashboards</li>
                            <li>Backlink tracking & monitoring</li>
                            <li>White-label capability</li>
                            <li>API marketplace for third-party integrations</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- SECTION 10: ARCHITECTURE DIAGRAM -->
            <section id="architecture-diagram">
                <h2><span class="emoji">üó∫Ô∏è</span> Architecture Syst√®me Compl√®te</h2>

                <div class="diagram-container">
                    <pre class="mermaid">
graph TB
    subgraph "Client Layer"
        WEB[Web Browser]
        MOBILE[Mobile App]
    end

    subgraph "Load Balancer"
        LB[Nginx]
    end

    subgraph "Symfony Application"
        API[API Platform<br/>REST API]
        AUTH[Authentication Service]
        CAMPAIGN[Campaign Service]
        MEDIA[Media Service]
        PUB[Publication Service]
        MAKE_SVC[Make API Service]
        ANALYTICS[Analytics Service]
    end

    subgraph "Background Workers"
        QUEUE[RabbitMQ Workers]
        SCHEDULER[Cron Scheduler]
    end

    subgraph "Data Layer"
        PG[(PostgreSQL<br/>Main DB + FTS)]
        REDIS[(Redis<br/>Cache & Sessions)]
        MEILISEARCH[(Meilisearch<br/>Search)]
    end

    subgraph "External Storage"
        SHAREPOINT[SharePoint<br/>Microsoft Graph API]
    end

    subgraph "Make.com"
        MAKE_API[Make REST API]
        MAKE_CONN[Social Connections<br/>OAuth Managed]
        MAKE_SCEN[Scenarios<br/>Auto-created]
    end

    subgraph "N8N Workflows"
        N8N_VIDEO[Video Generation]
        N8N_IMAGE[Image Processing]
        N8N_TEXT[Text Generation AI]
        N8N_ANALYTICS[Analytics Collection]
    end

    subgraph "Social Platforms"
        FB[Facebook]
        IG[Instagram]
        YT[YouTube]
        TW[Twitter/X]
        LI[LinkedIn]
        WP[WordPress]
    end

    WEB --> LB
    MOBILE --> LB
    LB --> API

    API --> AUTH
    API --> CAMPAIGN
    API --> MEDIA
    API --> PUB
    API --> MAKE_SVC
    API --> ANALYTICS

    AUTH --> PG
    AUTH --> REDIS

    CAMPAIGN --> PG
    MEDIA --> SHAREPOINT
    MEDIA --> MEILISEARCH

    PUB --> QUEUE
    PUB --> MAKE_SCEN

    MAKE_SVC --> MAKE_API
    MAKE_API --> MAKE_CONN
    MAKE_CONN --> MAKE_SCEN

    QUEUE --> N8N_VIDEO
    QUEUE --> N8N_IMAGE
    QUEUE --> N8N_TEXT

    N8N_VIDEO --> SHAREPOINT
    N8N_IMAGE --> SHAREPOINT

    SCHEDULER --> N8N_ANALYTICS

    MAKE_SCEN --> FB
    MAKE_SCEN --> IG
    MAKE_SCEN --> YT
    MAKE_SCEN --> TW
    MAKE_SCEN --> LI
    MAKE_SCEN --> WP

    FB -.Callback.-> API
    IG -.Callback.-> API

    N8N_ANALYTICS --> FB
    N8N_ANALYTICS --> IG
    N8N_ANALYTICS --> YT
    N8N_ANALYTICS --> PG

    ANALYTICS --> PG
    ANALYTICS --> REDIS

    style MAKE_API fill:#764ba2,color:#fff
    style MAKE_SCEN fill:#764ba2,color:#fff
    style SHAREPOINT fill:#48bb78,color:#fff
    style N8N_VIDEO fill:#f6ad55,color:#000
    style N8N_IMAGE fill:#f6ad55,color:#000
    style N8N_TEXT fill:#f6ad55,color:#000
    style N8N_ANALYTICS fill:#f6ad55,color:#000
                    </pre>
                </div>
            </section>

            <!-- SECTION 11: CONCLUSION -->
            <section id="conclusion">
                <h2><span class="emoji">‚úÖ</span> Conclusion</h2>

                <div class="success-box highlight-box">
                    <h3>Avantages de cette Architecture</h3>

                    <h4>Configuration par l'Agent</h4>
                    <ul>
                        <li>‚úÖ <strong>Centralisation</strong> - L'agent configure une fois, tous utilisent</li>
                        <li>‚úÖ <strong>S√©curit√©</strong> - Pas de tokens OAuth dans le CMS</li>
                        <li>‚úÖ <strong>R√©utilisation</strong> - M√™mes comptes pour toutes les campagnes</li>
                        <li>‚úÖ <strong>Simplicit√©</strong> - Utilisateurs s√©lectionnent juste les comptes</li>
                    </ul>

                    <h4>Sc√©narios Make Basiques</h4>
                    <ul>
                        <li>‚úÖ <strong>Simplicit√©</strong> - 3 modules seulement (Webhook ‚Üí Publish ‚Üí Callback)</li>
                        <li>‚úÖ <strong>Maintenance</strong> - Pas de logique complexe</li>
                        <li>‚úÖ <strong>Fiabilit√©</strong> - Moins de points de d√©faillance</li>
                        <li>‚úÖ <strong>R√©utilisabilit√©</strong> - Un sc√©nario = plusieurs campagnes</li>
                    </ul>

                    <h4>S√©paration N8N / Make</h4>
                    <ul>
                        <li>‚úÖ <strong>N8N</strong> - Content generation (vid√©o, image, texte, analytics)</li>
                        <li>‚úÖ <strong>Make</strong> - Publication UNIQUEMENT</li>
                        <li>‚úÖ <strong>Clart√©</strong> - Chaque outil a un r√¥le pr√©cis</li>
                        <li>‚úÖ <strong>√âvolutivit√©</strong> - Ajout facile de nouveaux workflows</li>
                    </ul>
                </div>

                <div class="info-box highlight-box">
                    <h3>Prochaines √âtapes</h3>
                    <ol>
                        <li>‚úÖ Valider l'architecture avec les stakeholders</li>
                        <li>‚è≥ Cr√©er compte Make.com Team</li>
                        <li>‚è≥ Configurer SharePoint site</li>
                        <li>‚è≥ Installer Meilisearch (Docker)</li>
                        <li>‚è≥ D√©velopper Make API Service (Symfony)</li>
                        <li>‚è≥ Cr√©er templates de sc√©narios Make pour chaque plateforme</li>
                        <li>‚è≥ Impl√©menter Graph API service pour SharePoint</li>
                        <li>‚è≥ POC: Agent configure Facebook ‚Üí Make scenario ‚Üí Publication</li>
                        <li>‚è≥ Installer N8N et cr√©er workflows de g√©n√©ration</li>
                        <li>‚è≥ D√©velopper interface utilisateur (Symfony + Twig ou React)</li>
                    </ol>
                </div>
            </section>
        </main>

        <footer>
            <p><strong>CMS Campagnes M√©dia - Architecture Finale v2.0</strong></p>
            <p>F√©vrier 2026</p>
            <p>Symfony 7.x | PostgreSQL | Redis | RabbitMQ | Meilisearch | SharePoint | Make.com | N8N</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35
            }
        });

        // Smooth scrolling for navigation
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
</body>
</html>